<div class="reservations-container">
  <!-- Header -->
  <div class="page-header">
    <h2>All Reservations</h2>
    <div class="header-stats">
      <nz-tag nzColor="blue">Total: {{ total }}</nz-tag>
      <nz-tag nzColor="orange">Pending: {{ getPendingCount() }}</nz-tag>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div nz-row [nzGutter]="[16, 16]" nzAlign="middle">
      <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="6">
        <nz-select [(ngModel)]="filterStatus" nzPlaceHolder="Filter by Status" nzAllowClear style="width: 100%;"
                   (ngModelChange)="onFilterChange()">
          <nz-option nzValue="ALL" nzLabel="All Statuses"></nz-option>
          <nz-option nzValue="PENDING" nzLabel="Pending"></nz-option>
          <nz-option nzValue="APPROVED" nzLabel="Approved"></nz-option>
          <nz-option nzValue="REJECTED" nzLabel="Rejected"></nz-option>
          <nz-option nzValue="CHECKED_IN" nzLabel="Checked In"></nz-option>
          <nz-option nzValue="CHECKED_OUT" nzLabel="Checked Out"></nz-option>
          <nz-option nzValue="CANCELLED" nzLabel="Cancelled"></nz-option>
        </nz-select>
      </div>
      <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="6">
        <nz-range-picker [(ngModel)]="dateRange" (ngModelChange)="onFilterChange()" style="width: 100%;"></nz-range-picker>
      </div>
      <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="4">
        <button nz-button (click)="clearFilters()" *ngIf="filterStatus || dateRange">
          <span nz-icon nzType="close"></span> Clear Filters
        </button>
      </div>
    </div>
  </div>

  <!-- Table -->
  <div class="table-wrapper">
    <nz-spin [nzSpinning]="loading">
      <nz-table #basicTable [nzData]="reservations" [nzShowPagination]="false" [nzBordered]="false"
                [nzSize]="'middle'" [nzNoResult]="noDataTpl">
        <thead>
          <tr>
            <th nzWidth="80px">#ID</th>
            <th>Guest</th>
            <th>Room</th>
            <th>Check-In</th>
            <th>Check-Out</th>
            <th nzWidth="100px">Amount</th>
            <th nzWidth="130px">Status</th>
            <th nzWidth="120px">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let reservation of basicTable.data">
            <td><strong>#{{ reservation.id }}</strong></td>
            <td>
              <div class="guest-info">
                <span class="guest-name">{{ reservation.username || reservation.userName }}</span>
              </div>
            </td>
            <td>
              <div class="room-info">
                <span class="room-name">{{ reservation.roomName }}</span>
                <span class="room-type">{{ reservation.roomType }}</span>
              </div>
            </td>
            <td>{{ reservation.checkInDate }}</td>
            <td>{{ reservation.checkOutDate }}</td>
            <td><strong>₹{{ reservation.price | number }}</strong></td>
            <td>
              <nz-tag [nzColor]="getStatusColor(reservation.reservationStatus)">
                <span nz-icon [nzType]="getStatusIcon(reservation.reservationStatus)"></span>
                {{ reservation.reservationStatus }}
              </nz-tag>
            </td>
            <td>
              <div class="action-buttons" *ngIf="reservation.reservationStatus === 'PENDING'">
                <button nz-button nzType="primary" nzSize="small" nzShape="circle"
                        (click)="changeReservationStatus(reservation.id, 'Approve')"
                        nz-tooltip nzTooltipTitle="Approve">
                  <span nz-icon nzType="check"></span>
                </button>
                <button nz-button nzType="default" nzDanger nzSize="small" nzShape="circle"
                        (click)="changeReservationStatus(reservation.id, 'REJECT')"
                        nz-tooltip nzTooltipTitle="Reject" style="margin-left: 8px;">
                  <span nz-icon nzType="close"></span>
                </button>
              </div>
              <span *ngIf="reservation.reservationStatus !== 'PENDING'" class="no-action">—</span>
            </td>
          </tr>
        </tbody>
      </nz-table>
      <ng-template #noDataTpl>
        <nz-empty [nzNotFoundContent]="'No reservations found'"></nz-empty>
      </ng-template>
    </nz-spin>
  </div>

  <!-- Pagination -->
  <div class="pagination-wrapper" *ngIf="total > 0">
    <nz-pagination
      [nzPageIndex]="currentPage"
      [nzTotal]="total"
      [nzPageSize]="10"
      (nzPageIndexChange)="pageIndexChange($event)"
      nzShowSizeChanger="false">
    </nz-pagination>
  </div>
</div>
